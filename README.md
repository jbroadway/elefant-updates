# Elefant Updates

This repository contains update files (patches and scripts) for the
[Elefant CMS](http://www.elefantcms.com/). It is used by the CMS to
check for, fetch, and apply new updates.

The Elefant admin toolbar will check the raw URLs in this repository
looking for the following form:

	https://raw.github.com/jbroadway/elefant-updates/master/releases/1.3.json

This file contains the latest release available for that series in the form:

	{"latest": "1.3.6"}

This can also be called via JSONP like this:

	https://raw.github.com/jbroadway/elefant-updates/master/releases/1.3.js?callback=elefant_release_update

This will return the same result in the form:

	elefant_release_update({"latest": "1.3.6"})

If a new version is available (compared to the site's current version),
Elefant can then request a list of all available scripts and patches
like this:

	https://raw.github.com/jbroadway/elefant-updates/master/patches.json

This will contain the following data structure:

	{
		"patches": [
			"https:\/\/raw.github.com\/jbroadway\/elefant-updates\/master\/patches\/elefant-1.3.4-1.3.5.patch",
			"https:\/\/raw.github.com\/jbroadway\/elefant-updates\/master\/patches\/elefant-1.3.5-1.3.6.patch"
		],
		"scripts": [
		]
	}

## How to update for new releases

First, generate your patch file via the following:

	diff -urBNs elefant-v1 elefant-v2 > elefant-v1-v2.patch

Then move this file into the `patches` folder.

The `patches.json` file is generated by the `scripts/patches.php` file like this:

	php scripts/patches.php

Next, edit the appropriate `releases/*.json` files with the latest version number.
The `.js` files for the JSONP support can then be created via:

	php scripts/callbacks.php

Finally, create the checksums for the updater to verify the authenticity of the
update files. This assumes that the `elefantcms/checksums` repository was cloned
into a folder beside the `jbroadway/elefant-updates` folder.

	php scripts/checksums.php

The regenerated files can be committed and pushed to the two respective Github
repositories.
